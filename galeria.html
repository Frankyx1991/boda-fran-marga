<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Fran & Marga ‚Äî Galer√≠a</title>
<style>
  body {
    margin: 0;
    height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: url('images/portada.jpg') no-repeat center center/cover;
    color: #fff;
    font-family: 'Georgia', serif;
    text-align: center;
    text-shadow: 0 2px 8px rgba(0,0,0,.6);
  }
  h1 { font-size: 2rem; margin: 0; }
  h2 { font-weight: 400; margin: 6px 0 22px; }
  .botones { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
  button {
    background: #a47c3c;
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 1rem;
    padding: 10px 18px;
    cursor: pointer;
    transition: .3s;
  }
  button:hover { background: #c59745; }
  #uploader {
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,.7); color: #fff;
    display: flex; flex-direction: column;
    justify-content: center; align-items: center;
    z-index: 100;
  }
  #bar {
    width: 80%; height: 10px;
    background: rgba(255,255,255,.3);
    border-radius: 8px; overflow: hidden; margin-top: 10px;
  }
  #barFill { background: #f0d88a; width: 0%; height: 100%; }
  #toast {
    position: fixed; bottom: 20px; left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,.7);
    color: #fff; padding: 10px 20px; border-radius: 10px;
    opacity: 0; transition: opacity .3s;
  }
  #toast.show { opacity: 1; }
</style>
</head>
<body>
  <h1>Fran & Marga</h1>
  <h2>11/10/2025</h2>

  <div class="botones">
    <button id="btnPhoto">üì∑ Tomar foto</button>
    <button id="btnVideo">üé• Grabar v√≠deo</button>
    <button id="btnGallery">üñºÔ∏è Subir desde galer√≠a</button>
  </div>

  <input type="file" accept="image/*" capture="environment" id="inPhoto" hidden>
  <input type="file" accept="video/*" capture="user" id="inVideo" hidden>
  <input type="file" accept="image/*,video/*" id="inGallery" hidden>

  <div id="uploader" hidden>
    <h3>Subiendo...</h3>
    <div id="bar"><div id="barFill"></div></div>
    <p id="pct">0%</p>
    <p>No cierres esta p√°gina</p>
  </div>
  <div id="toast"></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

  <script>
  const firebaseConfig = {
    apiKey: "AIzaSyCnkjY4-MceKRyLmQlMVaA39hUIQ6nMVO8",
    authDomain: "boda-fran-marga-live.firebaseapp.com",
    projectId: "boda-fran-marga-live",
    storageBucket: "boda-fran-marga-live.appspot.com",
    messagingSenderId: "945235222189",
    appId: "1:945235222189:web:ed972fab8e98620d21b024"
  };
  firebase.initializeApp(firebaseConfig);
  const storage = firebase.storage();

  const toast = (msg) => {
    const el = document.getElementById('toast');
    el.textContent = msg;
    el.classList.add('show');
    clearTimeout(window.toastTimer);
    window.toastTimer = setTimeout(() => el.classList.remove('show'), 4000);
  };

  const showUploader = (show) => {
    document.getElementById('uploader').hidden = !show;
    if(show) document.getElementById('barFill').style.width = '0%';
  };

  const setProgress = (p) => {
    document.getElementById('barFill').style.width = p + '%';
    document.getElementById('pct').textContent = p + '%';
  };

  async function uploadFile(file, folder) {
    if (!file) return toast("No se seleccion√≥ ning√∫n archivo.");
    const ts = new Date().toISOString().replace(/[:.]/g, '-');
    const path = `boda-fran-marga/${folder}/${ts}_${file.name}`;
    const ref = storage.ref(path);
    const meta = { contentType: file.type || 'application/octet-stream' };
    showUploader(true);

    try {
      const task = ref.put(file, meta);
      task.on('state_changed', snap => {
        const pct = Math.round((snap.bytesTransferred / snap.totalBytes) * 100);
        setProgress(pct);
      });
      await task;
      toast('‚úÖ ¬°Gracias por compartir este momento con nosotros!');
    } catch (err) {
      console.error(err);
      toast('‚ùå Error al subir: ' + (err.code || err.message));
    } finally {
      showUploader(false);
    }
  }

  document.getElementById('btnPhoto').onclick   = () => inPhoto.click();
  document.getElementById('btnVideo').onclick   = () => inVideo.click();
  document.getElementById('btnGallery').onclick = () => inGallery.click();

  const inPhoto = document.getElementById('inPhoto');
  const inVideo = document.getElementById('inVideo');
  const inGallery = document.getElementById('inGallery');

  inPhoto.onchange   = e => uploadFile(e.target.files[0], 'fotos');
  inVideo.onchange   = e => uploadFile(e.target.files[0], 'videos');
  inGallery.onchange = e => uploadFile(e.target.files[0], 'galeria');
  </script>
</body>
</html>